name: Publish

on:
  workflow_dispatch:
  push:
    tags:
      - "v*"

permissions:
  contents: read
  packages: write

jobs:
  publish-core-linux-all-examples:
    name: Publish Core/Linux/All/Examples
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: "17"

      - name: Set up Gradle
        uses: gradle/actions/setup-gradle@v4

      - name: Publish modules
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          GITHUB_ACTOR: ${{ github.actor }}
        run: >
          ./gradlew
          :mediainterface-core:publish
          :mediainterface-linux:publish
          :mediainterface-all:publish
          :examples:publish
          --no-daemon
          -Pgpr.repo=${{ github.repository }}

  publish-windows:
    name: Publish Windows Module
    runs-on: windows-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: "17"

      - name: Set up Gradle
        uses: gradle/actions/setup-gradle@v4

      - name: Publish module
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          GITHUB_ACTOR: ${{ github.actor }}
        run: >
          .\gradlew.bat
          :mediainterface-windows:publish
          --no-daemon
          -Pgpr.repo=${{ github.repository }}

  publish-macos:
    name: Publish macOS Module
    runs-on: macos-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: "17"

      - name: Set up Gradle
        uses: gradle/actions/setup-gradle@v4

      - name: Publish module
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          GITHUB_ACTOR: ${{ github.actor }}
        run: >
          ./gradlew
          :mediainterface-macos:publish
          --no-daemon
          -Pgpr.repo=${{ github.repository }}
